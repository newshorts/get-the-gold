<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></meta>
        <title>Test</title>
        <link rel="stylesheet" type="text/css" href="css/style.css" />
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
        <script type="text/javascript" src="js/easeljs-0.4.2.min.js"></script>
        <script>
            var canvas,
                stage,
                imgSeq = new Image(),
                bmpAnim,
                fpsLabel;
                
            function init() {
                canvas = document.getElementById('gold-mouse');
                stage = new Stage(canvas);
                
                stage.onMouseMove = moveCanvas;
                stage.onMouseDown = clickCanvas;
                
                var data = {
                    images: ['images/coin-sprite.png'],
                    frames: {
                        width: 53,
                        height: 56,
                        regX: 0,
                        regY: 0
                    }
                }
                
                bmpAnim = new BitmapAnimation(new SpriteSheet(data));
                
                fpsLabel = new Text("-- fps", "bold 14px Arial", "#fff");
                stage.addChild(fpsLabel);
                fpsLabel.x = 10;
                fpsLabel.y = 20;
                
                Ticker.setFPS(20);
                Ticker.addListener(window);
            }
            
            function tick() {
                var l = stage.getNumChildren();
                for(var i=l-1; i>0; i--) {
                    var sparkle = stage.getChildAt(i);
                    
                    sparkle.vY += 2;
                    sparkle.vX *= 0.98;
                    
                    sparkle.x += sparkle.vX;
                    sparkle.y += sparkle.vY;
                    sparkle.scaleX = sparkle.scaleY = sparkle.scaleX+sparkle.vS;
                    sparkle.alpha += sparkle.vA;
                    
                    if(sparkle.alpha <= 0 || sparkle.y > canvas.height) {
                        stage.removeChildAt(i);
                    }
                }
                
                fpsLabel.text = Math.round(Ticker.getMeasuredFPS()) + " fps";
                
                stage.update();
            }
            
            function clickCanvas(evt) {
                addSparkles(Math.random()*100+50|0, stage.mouseX, stage.mouseY, 2);
            }
            
            function moveCanvas(evt) {
                addSparkles(Math.random()*1+1|0, stage.mouseX, stage.mouseY, 1);
            }
            
            function addSparkles(count, x, y, speed) {
                for(var i = 0; i < count; i++) {
                    var sparkle = bmpAnim.clone();
                    
                    sparkle.x = x;
                    sparkle.y = y;
                    
                    sparkle.alpha = Math.random()*0.5+0.5;
                    sparkle.scaleX = sparkle.scaleY = Math.random()+0.3;
                    
                    var a = Math.PI*2*Math.random();
                    var v = (Math.random()-0.5)*30*speed;
                    sparkle.vX = Math.cos(a)*v;
                    sparkle.vY = Math.sin(a)*v;
                    sparkle.vS = (Math.random()-0.5)*0.2;
                    sparkle.vA = -Math.random()*0.05-0.01;
                    
                    sparkle.gotoAndPlay(Math.random()*sparkle.spriteSheet.getNumFrames()|0);
                    
                    stage.addChild(sparkle);
                }
            }
        </script>
        <script>
            (function($) {
                $(window).load(function() {
                    
                    var gm = $('#gold-mouse');
                    
                    var w = $(this).width(),
                        h = $(this).height();
                        
                    gm.attr('width', w);
                    gm.attr('height', h);
                    
                    init();
                });
            })(jQuery);
        </script>
    </head>
    <body>
        <div id="gold">
            <div id="gold-wrap">
                <div id="gold-bar">
                    <div id="gold-mario"></div>
                    <div id="gold-toggle-wrap">
                        <a id="gold-toggle" href="">
                            <span id="gold-toggle-button"></span>
                        </a>
                    </div>
                </div>
                <div id="gold-score">
                    <canvas id="gold-score-coin" width="53" height="56"></canvas>
                </div>
            </div>
        </div>
        <div id="gold-mouse-wrap">
            <canvas id="gold-mouse" width="960" height="400"></canvas>
        </div>
    </body>
</html>